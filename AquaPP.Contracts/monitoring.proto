syntax = "proto3";

package aquapp.monitoring;

import "data.proto";
import "google/protobuf/empty.proto";

// --- SERVICES ---

// Service for real-time sensor data and alerts.
service RealTimeMonitoringService {
  // 1. Streams real-time sensor data from the server to the Avalonia client.
  // The client requests the stream with an Empty message.
  rpc StreamReadings(google.protobuf.Empty) returns (stream aquapp.data.SensorReading);

  // 2. Streams real-time alerts from the server to the Avalonia client.
  rpc StreamAlerts(google.protobuf.Empty) returns (stream aquapp.data.Alert);
}

// Service for configuration and historical data management.
service ConfigurationService {
  // 1. Retrieves a list of all monitored assets (for the Asset Directory View).
  rpc GetAssets(google.protobuf.Empty) returns (stream aquapp.data.Asset);

  // 2. Saves or updates a single asset's configuration (e.g., updating thresholds).
  rpc UpdateAsset(aquapp.data.Asset) returns (aquapp.data.Asset);
  
  // 3. Retrieves historical data for a specific sensor (for charting history).
  // Request: Asset ID, Parameter Name, Start/End time.
  rpc GetHistoricalReadings(HistoricalQuery) returns (stream aquapp.data.SensorReading);

  // 4. Allows the client to acknowledge a specific alert.
  rpc AcknowledgeAlert(AlertIdRequest) returns (aquapp.data.Alert);
}

// --- SERVICE HELPER MESSAGES ---

// Request message for retrieving historical data.
message HistoricalQuery {
  string assetId = 1;
  string parameterName = 2;
  int64 startTime = 3;
  int64 endTime = 4;
}

// Request message for acknowledging an alert.
message AlertIdRequest {
  string alertId = 1;
}